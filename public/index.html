<!-- public/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The Jury Game</title>
</head>
<body>
  <h1>The Jury Game</h1>
  <p>Enter your name to join the jury room:</p>
  <input id="username" placeholder="Your name">
  <button id="joinBtn">Join Game</button>

  <h2>Phase:</h2>
  <div id="phase"></div>

  <h2>Votes:</h2>
  <ul id="votes"></ul>

  <h2>Evidence:</h2>
  <div id="evidence"></div>

  <button id="nextPhaseBtn" style="display:none;">Next Phase</button>
  <br/><br/>
  <textarea id="evidenceText" placeholder="Evidence text"></textarea>
  <input id="recipient" placeholder="Recipient juror # or 'all'">
  <button id="sendEvidenceBtn" style="display:none;">Send Evidence</button>

  <h3>Submit Vote</h3>
  <input id="voteInput" placeholder="Your vote">
  <button id="submitVoteBtn">Submit Vote</button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let jurorNumber = null;
    let username = '';

    document.getElementById('joinBtn').onclick = () => {
      username = document.getElementById('username').value.trim();
      if (username) socket.emit('join', username);
    };

    socket.on('joinedGM', (data) => {
      document.getElementById('phase').innerText = data.phase;
      document.getElementById('nextPhaseBtn').style.display = 'inline';
      document.getElementById('sendEvidenceBtn').style.display = 'inline';
    });

    socket.on('joinedPlayer', (data) => {
      jurorNumber = data.jurorNumber;
      document.getElementById('phase').innerText = data.phase;
      updateVotesList(data.publicVotes);
    });

    socket.on('phaseUpdated', (phase) => {
      document.getElementById('phase').innerText = phase;
    });

    socket.on('updateVotes', (votes) => {
      updateVotesList(votes);
    });

    socket.on('newEvidence', (text) => {
      const div = document.createElement('div');
      div.innerText = text;
      document.getElementById('evidence').appendChild(div);
    });

    document.getElementById('nextPhaseBtn').onclick = () => {
      socket.emit('nextPhase');
    };

    document.getElementById('sendEvidenceBtn').onclick = () => {
      const text = document.getElementById('evidenceText').value.trim();
      const recipient = document.getElementById('recipient').value.trim();
      if (text && recipient) {
        socket.emit('sendEvidence', { text, recipient });
      }
    };

    document.getElementById('submitVoteBtn').onclick = () => {
      const vote = document.getElementById('voteInput').value.trim();
      if (vote && jurorNumber) {
        socket.emit('submitVote', { jurorNumber, username, vote });
      }
    };

    function updateVotesList(votes) {
      const list = document.getElementById('votes');
      list.innerHTML = '';
      votes.forEach(v => {
        const li = document.createElement('li');
        li.innerText = v;
        list.appendChild(li);
      });
    }
  </script>
</body>
</html>

